<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cxp.graduate.mapper.UserMapper"> 
   
   <!-- 根据用户名及密码查询用户 -->
   <resultMap type="User" id="userMap">
   		<result property="userID" column="userID"/>
   		<result property="userName" column="userName"/>
   		<result property="userPwd"  column="userPwd"/>
   	 	<result property="userEmail" column="userEmail"/>
   	 	<result property="registTime" column="registTime"/>
    </resultMap>
   <select id="findUserByName" resultMap="userMap" parameterType="User">
   	select * from user where userName=#{userName} and userPwd=#{userPwd}
   </select>
   
   
   <!-- 根据用户名查询用户 -->
   <select id="selectUserByName" resultType="User" parameterType="String">
   	select * from user where userName=#{userName}
   </select>
   
   <!-- 根据邮箱名查询是否存在该邮箱 -->
   <resultMap type="String" id="existEmail">
   	 	<result property="userEmail" column="userEmail"/>
    </resultMap>
   <select id="findUserEmail" resultMap="existEmail" parameterType="String">
   	select * from user where userEmail=#{userEmail}
   </select>
   
   <!-- 查询用户设备是否激活 -->
   <resultMap type="User" id="deviceMap">
		<result property="userID" column="userID"/>
		<collection property="devices" javaType="ArrayList" ofType="Device" column="uid_did">
			<id property="deviceID" column="deviceID"/>    
            <result property="activate" column="isActivate"/>
		</collection>
	</resultMap>
   <select id="findDeviceByID" resultMap="deviceMap" parameterType="int">
   	select * from user u,device d where u.userID = d.deviceID and u.userID = #{userID};
   </select>
   
   <!-- 插入用户返回自增主键id -->
   <insert id="insertUser" useGeneratedKeys="true" keyColumn="userID" keyProperty="userID" parameterType="User">
   		insert into user(userName,userPwd,userEmail,registTime) value (#{userName},#{userPwd},#{userEmail},#{registTime});
	</insert>
   
</mapper>