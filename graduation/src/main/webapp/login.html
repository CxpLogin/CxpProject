<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>智能物联系统登录</title>
		<!-- Bootstrap Start-->
		<meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
		<!-- Bootstrap End  -->
					
		<!--layui Start-->
		<link rel="stylesheet" href="layui/css/layui.css">
		<script src="layui/layui.js"></script>
		<!-- layui End-->
		
		<link rel="stylesheet" type="text/css" href="css/login.css"/>
		
		<!-- Jquery Start -->
		<script src="js/jquery-3.3.1.js"></script>
		<!-- Jquery End -->
		
		<!-- 登录表单 -->
		<script type="text/javascript">
			$(document).ready(function () {
				$("#lg_btn").click(function () {
					var params = $("#loginForm").serializeArray();
					var values = {};
					for( x in params ){
						values[params[x].name] = params[x].value;
					}
					var idata = JSON.stringify(values);
					$.ajax({
			        	type: "POST",//方法类型
			            url: "/graduation/user/login" ,//url
			            contentType:"application/json;charset=utf-8",
			            data: idata,
			            success: function (result) {
			            	var json= JSON.stringify(result);//将服务器传递json对象转成json字符串
			            	var obj = eval('(' + json + ')');//将json字符串转成json对象
		                   	if(obj.key == "error"){
		                   	 	alert(obj.message);
		                   	}else{
		                   		if(obj.key == "success"){
		                   			window.location.href="/graduation/user/index.jsp";//需要跳转的地址
		                   		}
		                   	}
			            },
			            error : function(result) {
			            	alert("其他问题");
			            }
			        });
				})
				
				$("#rg_btn").click(function () {
					var params = $("#registForm").serializeArray();
					var values = {};
					for( x in params ){
						values[params[x].name] = params[x].value;
					}
					var idata = JSON.stringify(values);
					alert(idata);
					$.ajax({
			        	type: "POST",//方法类型
			        	async:false,
			            url: "/graduation/user/regist" ,//url
			            contentType:"application/json;charset=utf-8",
			            data: idata,
			            success: function (result) {
			            	var json= JSON.stringify(result);//将服务器传递json对象转成json字符串
			            	var obj = eval('(' + json + ')');//将json字符串转成json对象
		                   	if(obj.key == "error"){
		                   		alert(obj.message);
		                   	}else{
		                   		if(obj.key == "success"){
		                   			window.location.href="/graduation/user/index.jsp";//需要跳转的地址
		                   		}
		                   	}
			            },
			            error : function(result) {
			            	alert(JSON.stringify(result));
			            }
			        });
				})
				//首次获取验证码
// 				$("#imgVerify").attr("src","/graduation/user/getVerify?"+Math.random());
				
				//获取验证码
// 			    function getVerify(){
// 			        var sr=document.getElementById('imgVerify')
// 			        sr.src = "/graduation/user/getVerify?"+Math.random();
// 			    }
			})
		</script>
	</head>
	
<body>	    
	<!-- 登录面板 -->
	<div class="panel"> 
  		<div class="layui-tab">
  			<ul class="layui-tab-title">
    		<li class="layui-this">登录</li>
    		<li>注册</li>
  			</ul>
  		<div class="layui-tab-content">
    		<div class="layui-tab-item layui-show">
    			<div style="text-align: center;">
    				<form class="form layui-form" action="" id="loginForm" method="post">
    					<div class="row layui-form-item">
			                <label class="layui-form-label"><i class="layui-icon layui-icon-username" style="font-size: 30px; color: #1E9FFF;"></i></label>
			                <div class="layui-input-block">
			                    <input type="text" name="loginName" lay-verify="username" placeholder="用户名称" autocomplete="off" class="layui-input">
			                </div>
			            </div>
			            <div class="row  layui-form-item">
			                <label class="layui-form-label"><i class="layui-icon layui-icon-password" style="font-size: 30px; color: #1E9FFF;"></i></label>
			                <div class="layui-input-block">
			                    <input type="password" name="loginPwd" lay-verify="pass" placeholder="用户密码" autocomplete="off" class="layui-input">
			                </div>
			            </div>
			            <div class="row  layui-form-item">
			                <label class="layui-form-label"><i class="layui-icon layui-icon-user" style="font-size: 30px; color: #1E9FFF;"></i></label>
			                <div class="layui-input-block">
			                    <select name="type" lay-verify="required" lay-search="">
			                        <option value="">用户类型</option>
			                        <option value="user">普通用户</option>
			                        <option value="admin">管理员</option>
			                    </select>
			            	</div>
			            </div>
			            <div>
				            <div class="row  layui-form-item">
				                <img id="imgVerify" src="/graduation/user/getVerify" nclick="/graduation/user/getVerify?'+new Date().getTime()" alt="点击更换验证码" /><a href="">看不清，换一张</a>
				           		<script type="text/javascript">
								    function change(){
										// 重新加载验证码图片 
										// 方法二：如果图片缓存
										document.getElementById("imgVerify").src = '/graduation/user/getVerify?' + new Date().getTime();
									}
								</script>
				            </div>
			            	<div class="row  layui-form-item">
				                <label class="layui-form-label"><i class="layui-icon layui-icon-vercode" style="font-size: 30px; color: #1E9FFF;"></i></label>
				                <div class="layui-input-block">
				                    <input type="text" name="code" lay-verify="pass" placeholder="请输入图中验证码" autocomplete="off" class="layui-input">
				                </div>
			            	</div>
			            </div>
			            <div class="layui-form-item">
			                <div class="layui-inline">
			                    <div class="layui-input-inline">
			                        <input type="checkbox" name="isRemeber" lay-skin="primary" title="记住账户" checked="">
			                    </div>
			                </div>
			                <div class="layui-inline" style="text-align: right;">
			                    <div class="layui-input-inline">
			                        <a href="###">
			                            <i class="layui-icon layui-icon-help" style="color:white;background-color: black;border-radius: 50%;"></i> 忘记密码</a>
			                    </div>
			                </div>
			            </div>
			            <div class=" layui-btn-group">
			                <button class="layui-btn layui-btn-radius layui-btn-normal" id="lg_btn">登录</button>
			            </div>
    				</form>
    			</div>
    		</div>
    		<div class="layui-tab-item">
    			<div style="text-align: center;">
    				<form class="form layui-form" action="" id="registForm" method="post">
    					 <div class="row layui-form-item">
			                <label class="layui-form-label"><i class="layui-icon layui-icon-username" style="font-size: 30px; color: #1E9FFF;"></i></label>
			                <div class="layui-input-block">
			                    <input type="text" name="registName" lay-verify="username" placeholder="用户名称" autocomplete="off" class="layui-input">
			                </div>
			            </div>
			            <div class="row  layui-form-item">
			                <label class="layui-form-label"><i class="layui-icon layui-icon-password" style="font-size: 30px; color: #1E9FFF;"></i></label>
			                <div class="layui-input-block">
			                    <input type="password" name="registPwd" lay-verify="pass" placeholder="用户密码" autocomplete="off" class="layui-input">
			                </div>
			            </div>
			            <div class="row  layui-form-item">
			                <label class="layui-form-label"><i class="layui-icon layui-icon-release" style="font-size: 30px; color: #1E9FFF;"></i></label>
			                <div class="layui-input-block">
			                    <input type="text" name="registEmail" lay-verify="required|email" placeholder="用户邮箱" autocomplete="off" class="layui-input">
			                </div>
			            </div>			            
			            <div class=" layui-btn-group">
			                <button class="layui-btn layui-btn-radius layui-btn-normal" id="rg_btn">注册</button>
			            </div>
    				</form>
    			</div>
    		</div>
  		</div>
		</div> 
  	</div> 

<script src="layui/layui.js" charset="utf-8"></script>
<script>
//切换注册与登录
	layui.use('element', function(){
	  var $ = layui.jquery
	  ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
	  $('.site-demo-active').on('click', function(){
	var othis = $(this), type = othis.data('type');
	active[type] ? active[type].call(this, othis) : '';
	  });
	});

	layui.use('form', function(){
	  var form = layui.form
		//自定义验证规则
	 	form.verify({
			//用户名校验规则
		  	username: function(value, item){ //value：表单的值、item：表单的DOM对象
		    if(!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(value)){
		      return '用户名不能为空或有特殊字符';
		    }
		    if(/(^\_)|(\__)|(\_+$)/.test(value)){
		      return '用户名首尾不能出现下划线\'_\'';
		    }
		    if(/^\d+\d+\d$/.test(value)){
		      return '用户名不能全为数字';
		    }
		  }
		  	//密码规则
		  	,pass: [
		    	/^[\S]{6,12}$/
		    	,'密码必须6到12位，且不能出现空格'
		  	] 
		});
	});

</script>
</body>
</html>
